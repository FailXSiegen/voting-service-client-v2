import{g as R,_ as C,r as y,v as z,a as O,u as B,c as V,w as T,b as I,d as c,o as l,e as t,f as _,h as p,i as u,t as o,j as x,k as d,l as m,m as g,M as A,F as G,n as J,p as L,S as Q,q as j,s as f,x as b,P as Y,y as q,z as H,R as W,A as X,B as Z,C as ee,D as te,E as se,G as ae,H as oe}from"./index-CKhrGuHr.js";const ie=R`
  mutation UpdateSystemSettings($input: SystemSettingsInput!) {
    updateSystemSettings(input: $input) {
      id
      useDirectStaticPaths
      useDbFooterNavigation
      faviconUrl
      titleSuffix
      recaptchaEnabled
      recaptchaSiteKey
      recaptchaSecretKey
      updatedAt
      updatedBy {
        id
        username
      }
    }
  }
`,le={class:"card"},ne={class:"card-header"},re={class:"card-title mb-0"},ce={class:"card-body"},de={class:"mb-3"},ue={class:"form-label"},he=["placeholder"],pe={class:"form-text"},ve={class:"mb-3"},me={class:"form-label"},ge={class:"input-group"},fe=["placeholder"],Se={class:"form-text"},ye={key:0,class:"mt-2"},be=["src"],_e={class:"ms-2 text-muted"},we={class:"mb-3"},Ee={class:"form-check"},ke={class:"form-check-label",for:"useDirectStaticPaths"},De={class:"form-text"},$e={class:"mb-3"},Ke={class:"form-check"},Ne={class:"form-check-label",for:"useDbFooterNavigation"},Ue={class:"form-text"},Pe={class:"mb-3"},Fe={class:"mb-3"},Me={class:"form-check"},Re={class:"form-check-label",for:"recaptchaEnabled"},Ce={class:"form-text"},ze={key:0,class:"ms-3"},Oe={class:"mb-3"},Be={class:"form-label"},Ve=["placeholder"],Te={class:"form-text"},Ie={class:"mb-3"},xe={class:"form-label"},Ae=["placeholder"],Ge={class:"form-text"},Je={class:"d-flex justify-content-end"},Le=["disabled"],Qe={key:0,class:"bi bi-hourglass-split me-1"},je={key:1,class:"bi bi-check-lg me-1"},Ye={key:0,class:"mt-3 text-muted small"},qe={key:0},He={__name:"SystemSettingsManager",setup(w){const r=y(!1),n=y(!1),{t:S}=z.useI18n(),s=O({useDirectStaticPaths:!0,useDbFooterNavigation:!0,faviconUrl:null,titleSuffix:"digitalwahl.org",recaptchaEnabled:!1,recaptchaSiteKey:"",recaptchaSecretKey:""}),{result:E,loading:Xe,refetch:k}=B(Q,{},{fetchPolicy:"cache-and-network"}),h=V(()=>{var e;return(e=E.value)==null?void 0:e.systemSettings});T(h,e=>{console.log("Received system settings:",JSON.stringify(e,null,2)),e&&(s.useDirectStaticPaths=e.useDirectStaticPaths,s.useDbFooterNavigation=e.useDbFooterNavigation,s.faviconUrl=e.faviconUrl,s.titleSuffix=e.titleSuffix||"digitalwahl.org",s.recaptchaEnabled=!!e.recaptchaEnabled,s.recaptchaSiteKey=e.recaptchaSiteKey||"",s.recaptchaSecretKey=e.recaptchaSecretKey||"",console.log("Updated form data:",JSON.stringify(s,null,2)))},{immediate:!0});const{mutate:D}=I(ie);function $(e){console.log("reCAPTCHA enabled changed:",e.target.checked),s.recaptchaEnabled=e.target.checked}function K(e){console.log("Site key changed:",e.target.value),s.recaptchaSiteKey=e.target.value}function N(e){console.log("Secret key changed:",e.target.value),s.recaptchaSecretKey=e.target.value}async function U(){r.value=!0;try{console.log("Saving system settings:",JSON.stringify(s,null,2));const e={useDirectStaticPaths:s.useDirectStaticPaths,useDbFooterNavigation:s.useDbFooterNavigation,faviconUrl:s.faviconUrl,titleSuffix:s.titleSuffix,recaptchaEnabled:!!s.recaptchaEnabled,recaptchaSiteKey:s.recaptchaSiteKey||"",recaptchaSecretKey:s.recaptchaSecretKey||""};console.log("Input data being sent:",JSON.stringify(e,null,2));const a=await D({input:e});console.log("Mutation result:",a);try{await k(),console.log("Refetch completed successfully")}catch(v){console.error("Refetch error:",v)}J(S("success.systemSettings.saved"),{type:"success"})}catch(e){console.error("Error in onSave:",e),console.error("Error details:",{message:e.message,graphQLErrors:e.graphQLErrors,networkError:e.networkError,stack:e.stack}),L(e)}finally{r.value=!1}}function P(e){s.faviconUrl=e.url,n.value=!1}function F(){console.warn("Favicon could not be loaded:",s.faviconUrl)}function M(e){if(!e)return"";try{return new Date(e).toLocaleString("de-DE",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch(a){return console.warn("Error formatting date:",a),e}}return(e,a)=>{var v;return l(),c(G,null,[t("div",le,[t("div",ne,[t("h5",re,[a[9]||(a[9]=t("i",{class:"bi bi-gear-fill me-2"},null,-1)),u(" "+o(e.$t("view.systemSettings.title")),1)])]),t("div",ce,[t("form",{onSubmit:x(U,["prevent"]),class:"needs-validation",novalidate:""},[t("div",de,[t("label",ue,o(e.$t("view.systemSettings.titleSuffix.label")),1),d(t("input",{"onUpdate:modelValue":a[0]||(a[0]=i=>s.titleSuffix=i),type:"text",class:"form-control",placeholder:e.$t("view.systemSettings.titleSuffix.placeholder")},null,8,he),[[m,s.titleSuffix]]),t("div",pe,o(e.$t("view.systemSettings.titleSuffix.help")),1)]),t("div",ve,[t("label",me,o(e.$t("view.systemSettings.favicon.label")),1),t("div",ge,[d(t("input",{"onUpdate:modelValue":a[1]||(a[1]=i=>s.faviconUrl=i),type:"url",class:"form-control",placeholder:e.$t("view.systemSettings.favicon.placeholder")},null,8,fe),[[m,s.faviconUrl]]),t("button",{type:"button",class:"btn btn-outline-secondary",onClick:a[2]||(a[2]=i=>n.value=!0)},[a[10]||(a[10]=t("i",{class:"bi bi-upload"},null,-1)),u(" "+o(e.$t("view.systemSettings.favicon.upload")),1)])]),t("div",Se,o(e.$t("view.systemSettings.favicon.help")),1),s.faviconUrl?(l(),c("div",ye,[t("img",{src:s.faviconUrl,alt:"Favicon Preview",class:"favicon-preview",onError:F},null,40,be),t("span",_e,o(e.$t("view.systemSettings.favicon.preview")),1)])):p("",!0)]),t("div",we,[t("div",Ee,[d(t("input",{id:"useDirectStaticPaths","onUpdate:modelValue":a[3]||(a[3]=i=>s.useDirectStaticPaths=i),class:"form-check-input",type:"checkbox"},null,512),[[g,s.useDirectStaticPaths]]),t("label",ke,o(e.$t("view.systemSettings.useDirectStaticPaths.label")),1)]),t("div",De,o(e.$t("view.systemSettings.useDirectStaticPaths.help")),1)]),t("div",$e,[t("div",Ke,[d(t("input",{id:"useDbFooterNavigation","onUpdate:modelValue":a[4]||(a[4]=i=>s.useDbFooterNavigation=i),class:"form-check-input",type:"checkbox"},null,512),[[g,s.useDbFooterNavigation]]),t("label",Ne,o(e.$t("view.systemSettings.useDbFooterNavigation.label")),1)]),t("div",Ue,o(e.$t("view.systemSettings.useDbFooterNavigation.help")),1)]),a[12]||(a[12]=t("hr",{class:"my-4"},null,-1)),t("h6",Pe,[a[11]||(a[11]=t("i",{class:"bi bi-shield-check me-2"},null,-1)),u(" "+o(e.$t("view.systemSettings.recaptcha.label")),1)]),t("div",Fe,[t("div",Me,[d(t("input",{id:"recaptchaEnabled","onUpdate:modelValue":a[5]||(a[5]=i=>s.recaptchaEnabled=i),class:"form-check-input",type:"checkbox","true-value":!0,"false-value":!1,onChange:$},null,544),[[g,s.recaptchaEnabled]]),t("label",Re,o(e.$t("view.systemSettings.recaptcha.enabled.label")),1)]),t("div",Ce,o(e.$t("view.systemSettings.recaptcha.enabled.help")),1)]),s.recaptchaEnabled?(l(),c("div",ze,[t("div",Oe,[t("label",Be,o(e.$t("view.systemSettings.recaptcha.siteKey.label")),1),d(t("input",{"onUpdate:modelValue":a[6]||(a[6]=i=>s.recaptchaSiteKey=i),type:"text",class:"form-control",placeholder:e.$t("view.systemSettings.recaptcha.siteKey.placeholder"),onInput:K},null,40,Ve),[[m,s.recaptchaSiteKey]]),t("div",Te,o(e.$t("view.systemSettings.recaptcha.siteKey.help")),1)]),t("div",Ie,[t("label",xe,o(e.$t("view.systemSettings.recaptcha.secretKey.label")),1),d(t("input",{"onUpdate:modelValue":a[7]||(a[7]=i=>s.recaptchaSecretKey=i),type:"password",class:"form-control",placeholder:e.$t("view.systemSettings.recaptcha.secretKey.placeholder"),onInput:N},null,40,Ae),[[m,s.recaptchaSecretKey]]),t("div",Ge,o(e.$t("view.systemSettings.recaptcha.secretKey.help")),1)])])):p("",!0),t("div",Je,[t("button",{type:"submit",class:"btn btn-primary",disabled:r.value},[r.value?(l(),c("i",Qe)):(l(),c("i",je)),u(" "+o(r.value?e.$t("view.systemSettings.saving"):e.$t("view.systemSettings.save")),1)],8,Le)])],32),(v=h.value)!=null&&v.updatedAt?(l(),c("div",Ye,[u(o(e.$t("view.systemSettings.lastUpdated"))+": "+o(M(h.value.updatedAt))+" ",1),h.value.updatedBy?(l(),c("span",qe,o(e.$t("view.systemSettings.updatedBy"))+" "+o(h.value.updatedBy.username),1)):p("",!0)])):p("",!0)])]),n.value?(l(),_(A,{key:0,show:n.value,onClose:a[8]||(a[8]=i=>n.value=!1),onSelected:P,"accept-types":"image/*","max-file-size":1024*1024},null,8,["show"])):p("",!0)],64)}}},We=C(He,[["__scopeId","data-v-73be8e24"]]),et={__name:"OrganizerGlobalSettings",setup(w){const r=j([W,X,Z,ee,te,se,ae,oe]);return(n,S)=>(l(),_(H,{"meta-title":n.$t("navigation.views.organizerGlobalSettings")},{title:f(()=>[u(o(n.$t("navigation.views.organizerGlobalSettings")),1)]),header:f(()=>[b(Y,{routes:q(r)},null,8,["routes"])]),content:f(()=>[b(We)]),_:1},8,["meta-title"]))}};export{et as default};
